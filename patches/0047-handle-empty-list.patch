From 5700e095c62b9dbb52447522699015ef7d877c06 Mon Sep 17 00:00:00 2001
From: KenC1014 <kenken4016@gmail.com>
Date: Mon, 17 Feb 2025 23:54:22 -0600
Subject: [PATCH 047/150] handle empty list

---
 GEMstack/onboard/perception/pedestrian_detection.py | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/GEMstack/onboard/perception/pedestrian_detection.py b/GEMstack/onboard/perception/pedestrian_detection.py
index 2a8ac193..9970c6a2 100644
--- a/GEMstack/onboard/perception/pedestrian_detection.py
+++ b/GEMstack/onboard/perception/pedestrian_detection.py
@@ -164,7 +164,7 @@ class PedestrianDetector2D(Component):
         # Extract 3D pedestrians points in lidar frame
         # ** These are camera frame after transform_lidar_points, right?
         # ** It was in camera frame before. I fixed it. Now they are in lidar frame!
-        pedestrians_3d_pts = [list(extracted_pts[:, -3:]) for extracted_pts in extracted_pts_all]
+        pedestrians_3d_pts = [[] if len(extracted_pts) == 0 else list(extracted_pts[:, -3:]) for extracted_pts in extracted_pts_all] 
 
         # Object center viz
         obj_3d_obj_centers = list()
@@ -176,7 +176,7 @@ class PedestrianDetector2D(Component):
                 obj_3d_obj_dims.append(agent.dimensions)
         
         # Extract 2D pedestrians points and bbox in camera frame
-        extracted_2d_pts = [list(extracted_pts[:, :2].astype(int)) for extracted_pts in extracted_pts_all]
+        extracted_2d_pts = [[] if len(extracted_pts) == 0 else list(extracted_pts[:, :2].astype(int)) for extracted_pts in extracted_pts_all]
         flattened_pedestrians_2d_pts = list()
         for pts in extracted_2d_pts:    flattened_pedestrians_2d_pts.extend(pts)
 
@@ -234,7 +234,7 @@ class PedestrianDetector2D(Component):
         # Extract 3D pedestrians points in lidar frame
         # ** These are camera frame after transform_lidar_points, right?
         # ** It was in camera frame before. I fixed it. Now they are in lidar frame!
-        pedestrians_3d_pts = [list(extracted_pts[:, -3:]) for extracted_pts in extracted_pts_all] 
+        pedestrians_3d_pts = [[] if len(extracted_pts) == 0 else list(extracted_pts[:, -3:]) for extracted_pts in extracted_pts_all] 
         if len(pedestrians_3d_pts) != num_objs:
             raise Exception('Perception - Camera detections, points clusters num. mismatch')
         
-- 
2.38.1

