From f29414aa2573c25adf43bffc0090d31d556d6d22 Mon Sep 17 00:00:00 2001
From: krishauser <hauser.kris@gmail.com>
Date: Wed, 30 Apr 2025 14:54:39 -0400
Subject: [PATCH 128/150] Added ability to override settings

---
 GEMstack/utils/settings.py | 22 ++++++++++++++++------
 main.py                    | 12 +++++++++---
 2 files changed, 25 insertions(+), 9 deletions(-)

diff --git a/GEMstack/utils/settings.py b/GEMstack/utils/settings.py
index b2470ce2..65d1ef46 100644
--- a/GEMstack/utils/settings.py
+++ b/GEMstack/utils/settings.py
@@ -1,23 +1,33 @@
 import json
-from ..knowledge import defaults
 import copy
 from typing import List,Union,Any
 
 SETTINGS = None
 
-def load_settings():
+def load_settings(settings_file : str = None):
     """Loads the settings object for the first time.
     
-    Order of operations is to look into defaults.SETTINGS, and then
-    look through the command line arguments to determine whether the user has
-    overridden any settings using --KEY=VALUE.
+    Order of operations is:
+    - If settings_file is given, load it.
+    - Otherwise, get the settings from defaults.SETTINGS
+    - Look through the command line arguments to determine whether the user has
+      overridden any settings using --KEY=VALUE.
     """
     global SETTINGS
     if SETTINGS is not None:
         return
     import os
     import sys
-    SETTINGS = copy.deepcopy(defaults.SETTINGS)
+    if settings_file is not None:
+        from .config import load_config_recursive
+        import os
+        print("**************************************************************")
+        print("Loading global settings from",settings_file)
+        print("**************************************************************")
+        SETTINGS = load_config_recursive(os.path.abspath(settings_file))
+    else:
+        from ..knowledge import defaults
+        SETTINGS = copy.deepcopy(defaults.SETTINGS)
     for arg in sys.argv:
         if arg.startswith('--'):
             k,v = arg.split('=',1)
diff --git a/main.py b/main.py
index 64d6afad..a30a833b 100644
--- a/main.py
+++ b/main.py
@@ -2,10 +2,16 @@ from GEMstack.utils import settings,config
 import sys
 
 if __name__=='__main__':
+    #check for settings override
+    for arg in sys.argv[1:]:
+        if arg.startswith('--settings='):
+            settings.load_settings(arg[11:])
+            break
+    #get launch file
     launch_file = None
     for arg in sys.argv[1:]:
         if arg.startswith('--run='):
-            launch_file = arg[9:]
+            launch_file = arg[6:]
             break
         elif not arg.startswith('--'):
             launch_file = arg
@@ -13,8 +19,8 @@ if __name__=='__main__':
     if launch_file is None:
         runconfig = settings.get('run',None)
         if runconfig is None:
-            print("Usage: python3 [--key1=value1 --key2=value2] LAUNCH_FILE.yaml")
-            print("  Current settings are found in knowledge/defaults/current.yaml")
+            print("Usage: python3 [--key1=value1 --key2=value2] [--settings=SETTINGS_OVERRIDE.yaml] LAUNCH_FILE.yaml")
+            print("  Default settings are found in knowledge/defaults/current.yaml")
             exit(1)
         else:
             print("Using default run configuration in knowledge/defaults/current.yaml")
-- 
2.38.1

