From c8495440032c50b109f82940e67948bf8c44e1ec Mon Sep 17 00:00:00 2001
From: nvikramraj <nvikramraj1305@gmail.com>
Date: Mon, 24 Feb 2025 09:37:18 -0600
Subject: [PATCH 075/150] remove viz

---
 GEMstack/onboard/perception/pedestrian_detection.py |  3 +++
 GEMstack/onboard/visualization/mpl_visualization.py | 10 +---------
 launch/fixed_route.yaml                             |  1 -
 launch/pedestrian_detection.yaml                    |  7 +++----
 4 files changed, 7 insertions(+), 14 deletions(-)

diff --git a/GEMstack/onboard/perception/pedestrian_detection.py b/GEMstack/onboard/perception/pedestrian_detection.py
index 36ad9c9d..f0d7df4e 100644
--- a/GEMstack/onboard/perception/pedestrian_detection.py
+++ b/GEMstack/onboard/perception/pedestrian_detection.py
@@ -401,6 +401,9 @@ class PedestrianDetector2D(Component):
             if (obj_centers[idx].size == 0) or (obj_dims[0].size == 0):
                 del obj_centers[idx]
                 del obj_dims[idx]
+            elif (obj_centers[idx].size != obj_dims[0].size):
+                del obj_centers[idx]
+                del obj_dims[idx]
         
         # Create list of agent states in current vehicle frame:
         agents = []
diff --git a/GEMstack/onboard/visualization/mpl_visualization.py b/GEMstack/onboard/visualization/mpl_visualization.py
index 77a3e42c..958be794 100644
--- a/GEMstack/onboard/visualization/mpl_visualization.py
+++ b/GEMstack/onboard/visualization/mpl_visualization.py
@@ -5,7 +5,6 @@ import matplotlib.pyplot as plt
 import matplotlib.animation as animation
 import time
 from collections import deque
-from ...state.agent import AgentEnum
 
 class MPLVisualization(Component):
     """Runs a matplotlib visualization at 10Hz. 
@@ -77,14 +76,7 @@ class MPLVisualization(Component):
             return
         self.num_updates += 1
         self.debug("vehicle","velocity",state.vehicle.v)
-        self.debug("vehicle","front wheel angle",state.vehicle.front_wheel_angle)
-        
-        # Add pedestrian tracking
-        for agent_id, agent in state.agents.items():
-            if agent.type == AgentEnum.PEDESTRIAN:
-                self.debug(f"ped_{agent_id}", "x", agent.pose.x)
-                self.debug(f"ped_{agent_id}", "y", agent.pose.y)
-        
+        self.debug("vehicle","front wheel angle",state.vehicle.front_wheel_angle)        
         time_str = time.strftime("%Y-%m-%d %H:%M:%S", time.localtime(state.t))
         #frame=ObjectFrameEnum.CURRENT
         #state = state.to_frame(frame)
diff --git a/launch/fixed_route.yaml b/launch/fixed_route.yaml
index 69f3b94b..c05de8ff 100644
--- a/launch/fixed_route.yaml
+++ b/launch/fixed_route.yaml
@@ -74,7 +74,6 @@ variants:
                     agent_detection : OmniscientAgentDetector
             visualization: !include "klampt_visualization.yaml"
             #visualization: !include "mpl_visualization.yaml"
-            visualization: [!include "klampt_visualization.yaml", !include "mpl_visualization.yaml"]
     log_ros:
         log:
             ros_topics : !include "../GEMstack/knowledge/defaults/standard_ros_topics.yaml"
\ No newline at end of file
diff --git a/launch/pedestrian_detection.yaml b/launch/pedestrian_detection.yaml
index 64a8e1c9..1a00fa79 100644
--- a/launch/pedestrian_detection.yaml
+++ b/launch/pedestrian_detection.yaml
@@ -57,10 +57,9 @@ variants:
     detector_only:
         run:
             description: "Run the pedestrian detection code"
-            drive:
-                planning:
-                    trajectory_tracking:
-            visualization: !include "mpl_visualization.yaml"
+        drive:
+            planning:
+                trajectory_tracking:
     real_sim:
         run:
             description: "Run the pedestrian detection code with real detection and fake simulation"
-- 
2.38.1

