From bf80bbeb034e8d90c22937d0c416833ceaec6721 Mon Sep 17 00:00:00 2001
From: LucasEby <lucaseby@outlook.com>
Date: Tue, 18 Feb 2025 18:33:13 -0500
Subject: [PATCH 053/150] Accidentally moved a few lines of code. Fixed the
 error that resulted

---
 .../onboard/perception/pedestrian_detection.py     | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

diff --git a/GEMstack/onboard/perception/pedestrian_detection.py b/GEMstack/onboard/perception/pedestrian_detection.py
index bf4b10e1..9e7815c9 100644
--- a/GEMstack/onboard/perception/pedestrian_detection.py
+++ b/GEMstack/onboard/perception/pedestrian_detection.py
@@ -242,6 +242,13 @@ class PedestrianDetector2D(Component):
         if len(pedestrians_3d_pts) != num_objs:
             raise Exception('Perception - Camera detections, points clusters num. mismatch')
         
+        # TODO: Slower but cleaner to pass dicts of AgentState
+        #       or at least {track_ids: centers/pts/etc}
+        # TODO: Combine funcs for efficiency in C.
+        #       Separate numpy prob still faster for now
+        obj_centers = self.find_centers(pedestrians_3d_pts) # Centers are calculated in lidar frame here
+        obj_dims = self.find_dims(pedestrians_3d_pts)
+
         # If in vehicle frame, transform centers from top_lidar frame to vehicle frame
         # Need to transform the center point one by one since matrix op can't deal with empty points
         if self.vehicle_frame:
@@ -254,13 +261,6 @@ class PedestrianDetector2D(Component):
                 else:
                     obj_centers_vehicle.append(np.array(()))
             obj_centers = obj_centers_vehicle
-        
-        # TODO: Slower but cleaner to pass dicts of AgentState
-        #       or at least {track_ids: centers/pts/etc}
-        # TODO: Combine funcs for efficiency in C.
-        #       Separate numpy prob still faster for now
-        obj_centers = self.find_centers(pedestrians_3d_pts) # Centers are calculated in current vehicle frame here (center of rear axle) 
-        obj_dims = self.find_dims(pedestrians_3d_pts)
 
         # TODO: CONVERT FROM VEHICLE FRAME TO START FRAME HERE
         self.find_vels_and_ids(obj_centers, obj_dims)
-- 
2.38.1

