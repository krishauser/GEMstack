<?xml version="1.0"?>
<launch>
    <arg name="name" default="oak" />

    <!-- Choose visualization -->
   <arg name="rviz" default="false" />
   <arg name="rtabmap_viz" default="false" />

   <!-- <param name="use_sim_time" type="bool" value="true"/> -->

    <node type="rgbd_odometry" name="rgbd_odometry" pkg="rtabmap_odom">
        <remap from="rgb/image" to="$(arg name)/rgb/image_raw"/>
        <remap from="rgb/camera_info" to="$(arg name)/rgb/camera_info"/>
        <remap from="depth/image" to="$(arg name)/stereo/image_raw"/>
        <param name="frame_id" type="string" value="$(arg name)"/>

        <rosparam param="subscribe_depth">True</rosparam>
        <rosparam param="approx_sync">True</rosparam>
        <rosparam param="approx_sync_max_interval">0.02</rosparam>
        
    </node>

    <node type="rtabmap" name="rtabmap" pkg="rtabmap_slam" output="screen" args="--delete_db_on_start">
        <remap from="rgb/image" to="$(arg name)/rgb/image_raw"/>
        <remap from="rgb/camera_info" to="$(arg name)/rgb/camera_info"/>
        <remap from="depth/image" to="$(arg name)/stereo/image_raw"/>
        <rosparam param="Rtabmap/DetectionRate">3.5</rosparam>
        <param name="frame_id" type="string" value="$(arg name)"/>
    </node>

    <!-- Visualisation RTAB-Map -->
      <node if="$(arg rtabmap_viz)" pkg="rtabmap_viz" type="rtabmap_viz" name="rtabmap_viz" args="-d $(find rtabmap_demos)/launch/config/rgbd_gui.ini" output="screen">
         <param name="subscribe_stereo"    type="bool"   value="true"/>
         <param name="subscribe_odom_info" type="bool"   value="true"/>
         <param name="queue_size"          type="int"    value="10"/>
         <param name="frame_id"            type="string" value="oak_left_camera_frame"/>
         <remap from="left/image_raw"    to="/oak/left/image_rect"/>
         <remap from="left/camera_info"  to="/oak/left/camera_info"/>
         <remap from="right/image_raw"   to="/oak/right/image_rect"/>
         <remap from="right/camera_info" to="/oak/right/camera_info"/>
         <remap from="odom_info"         to="/oak/odom_info"/>
         <remap from="odom"              to="/oak/odom"/>
      </node>

    <node if="$(arg rviz)" type="rviz" name="rviz" pkg="rviz">
        <remap from="rgb/image" to="$(arg name)/rgb/image_raw"/>
        <remap from="rgb/camera_info" to="$(arg name)/rgb/camera_info"/>
        <remap from="depth/image" to="$(arg name)/stereo/image_raw"/>
    </node>

</launch>
